<% provide(:title, "#{@movie.title}-映画情報・レビュー・評価")%>
<div class="row mt-3">
  <div class="col-md-3 movie_image">
    <% if @movie.picture.nil?%>
      <%= image_tag 'no_image.jpg', size: "260x364" %>
    <%else%>
      <%= image_tag @movie.picture, size: "260x364"%>
    <% end %>
  </div>
  <div class="col-md-9 movie_show_text">
    <h5 class="font-weight-bold"><%=@movie.title%>　
    <span class="small font-weight-bold">（<%= link_to "#{@movie.release.year}年", "#" %>製作の映画）</span></h5>
    <p>
      <span class="font-weight-bold">上映日：</span><%= "#{@movie.release.year}年#{@movie.release.mon}月#{@movie.release.day}日"%> ／
      <span class="font-weight-bold">製作国：</span><%= link_to @movie.production, "#"%> ／
      <span class="font-weight-bold">上映時間：</span><%= "#{@movie.screening_time}分"%> 
    </p>
    <p>
      <span class="font-weight-bold">ジャンル：</span><%= link_to @movie.genre, "#"%>
    </p>
    <div class="row">
      <div class="col-md-auto">
        <p class="mt-2"><span class="font-weight-bold">監督</span></p>
        <% director_ids = @movie.movie_casts.where(relation: "director").select(:cast_id)%>
        <% Cast.where(id: director_ids).each do |director| %>
          <%= link_to director.name, director, class: "btn btn-light btn-sm cast_name mt-1" %>
        <% end %>
      </div>
      <div class="col-md-auto">
        <p class="mt-2"><span class="font-weight-bold">脚本</span></p>
        <% writer_ids = @movie.movie_casts.where(relation: "writer").select(:cast_id)%>
        <% Cast.where(id: writer_ids).each do |writer| %>
          <%= link_to writer.name, writer, class: "btn btn-light btn-sm cast_name mt-1" %>
        <% end %>
      </div>
    </div>
    <p class="mt-3"><span class="font-weight-bold">出演者</span></p>
    <% actor_ids = @movie.movie_casts.where(relation: "actor").select(:cast_id)%>
    <% actor_ids.each do |actor_id| %>
      <% actor = Cast.find(actor_id.cast_id) %>
      <%= link_to actor.name, actor, class: "btn btn-light btn-sm cast_name mt-2 mr-1" %>
    <% end %>
  </div>
</div>
<div class="col-md-8">
  <div class="card card_top">
    <div class="card-header text-secondary"><%="「#{@movie.title}」に投稿された感想・評価" %></div>
    <div class="card-body movie_list">
      <% @reviews.each do |review| %>
        <% user = review.user%>
        <div class="card mb-3">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3 movie_image">
                <% if user.picture.nil?%>
                  <%= gravatar_for user %>
                <%else%>
                  <%= image_tag user.picture, size: "150x200"%>
                <% end %>
              </div>
              <div class="col-md-9 movie_text">
                <p class="card-text font-weight-bold"><%="#{user.nickname}の感想・評価"%></p>
                <p class="card-text text-secondary"><%=review.create_date%></p>
                <p class="card-text text-secondary"><%="評価：#{review.evaluation}"%></p>
              </div>
            </div>  
            <%=review.comment%>
          </div>
        </div>
      <% end %>
      <%= paginate @reviews, theme: 'twitter-bootstrap-4'%>
    </div>
  </div>
</div>